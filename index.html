<html>
  <head>
    <title>serenade.js demo</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">    
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/Audiolet.js"></script>
    <script type="text/javascript" src="js/ko.js"></script>
    <script type="text/javascript" src="js/serenade.js"></script>
    <script type="text/javascript">
       jQuery(document).ready(function() {
           var viewModel = {
               availableTunes: ko.observableArray(['zelda','still-alive']),
               tune:  ko.observable('zelda'),
	       section: ko.observable('midi'),
	       playingStatus: ko.observable(''),
	       midiPlayer: ko.observable(null)
           }
	   viewModel.play = function() {
	       var melodyInst = jQuery("#melody-instrument").val();
	       var bassInst = jQuery("#bass-instrument").val();
	       var melodyNotes = (viewModel.tune()==='zelda' ? jQuery("#melody-notes-zelda").val() : jQuery("#melody-notes-still-alive").val());
	       var bassNotes = (viewModel.tune()==='zelda' ? jQuery("#bass-notes-zelda").val() : jQuery("#bass-notes-still-alive").val());
	       var player = (viewModel.tune()==='zelda' ? jQuery("#midi-zelda").val() : jQuery("#midi-still-alive").val());
	       console.log(melodyInst+"\n"+bassInst+"\n"+melodyNotes+"\n"+bassNotes+"\n"+player);
	       viewModel.playingStatus('');
	       viewModel.section('playing');

	       eval("viewModel.midiPlayer((function(){\n"+ melodyInst+"\n"+bassInst+"\n"+melodyNotes+"\n"+bassNotes+"\n"+player+"; return midi; })())");
	   };
	   viewModel.stop = function() {
	       viewModel.midiPlayer().stop();
	       viewModel.section('midi');
	   };

	   window.viewModel = viewModel;       
	   window.updateState =function(track,notation){
	       var text = viewModel.playingStatus(), next;
	       if(notation.constructor === serenade.Note) {
		   next="\n"+track+": PLAYING "+notation.verbose()+" -> "+notation.freq()+":"+notation.dur;
	       } else if(notation.constructor === serenade.Chord) {
		   next="\n"+track+": PLAYING "+notation.verbose()+" -> "+notation.dur;
	       } else {
		   next="\n"+track+": PLAYING "+notation.verbose();
	       }
	       console.log(next);
	       viewModel.playingStatus(next+text);
	   };

	   ko.applyBindings(viewModel);
       });
    </script>
  </head>
  <body>
    <a href="https://github.com/antoniogarrote/serenade.js"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub"></a>

    <div class="container">

      <div class="row" style="margin-top:20px; margin-bottom:30px">
	<div class="span7">
	  <h1><a href="https://github.com/antoniogarrote/serenade.js">serenade.js</a> demo</h1>
	</div>
	<div class="span3 control-group">
	  <div class="controls" style="margin-top:5px" data-bind="visible:section()!=='playing'">
	    <select data-bind="options: availableTunes, value: tune"></select>
	  </div>
	</div>
	<div class="span2">
	  <a class="btn btn-success btn-primary btn-large" data-bind="click:play,visible:section()!=='playing'">Play</a>
	  <a class="btn btn-danger btn-primary btn-large" data-bind="click:stop,visible:section()==='playing'">Stop</a>
	</div>
      </div>


      <div class="row" style="margin-top:20px; margin-bottom:30px" data-bind="visible:section()==='playing'">
	<div class="span12">
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" style="width: 640px; height:500px" data-bind="value:playingStatus">
		</textarea>
	      </div>
	    </div>
	  </form>
	</div>
      </div>

<span data-bind="visible:section()!=='playing'">
      <ul class="nav nav-tabs">
        <li class="active" data-bind="css:{active: section()==='midi'}, click:function(){ viewModel.section('midi') }">
          <a href="#">Player</a>
        </li>
        <li data-bind="css:{active: section()==='notes-melody'}, click:function(){ viewModel.section('notes-melody') }">
          <a href="#">Melody notes</a>
        </li>
        <li data-bind="css:{active: section()==='notes-bass'}, click:function(){ viewModel.section('notes-bass') }">
	  <a href="#">Bass notes</a>
	</li>
        <li data-bind="css:{active: section()==='instrument-melody'}, click:function(){ viewModel.section('instrument-melody') }">
	  <a href="#">Melody instrument</a>
	</li>
        <li data-bind="css:{active: section()==='instrument-bass'}, click:function(){ viewModel.section('instrument-bass') }">
	  <a href="#">Bass instrument</a>
	</li>
      </ul>

      <div class="row" data-bind="visible:(section()==='midi' && tune()==='zelda')">
	<div class="span12">
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="midi-zelda" style="width:640px; height:300px">		  
var bpm = 90;
var tempoUnit = 1/4;
var midi = new serenade.Midi(bpm,tempoUnit);

// The Legend of Zelda by Koji Kondo
midi.seq_notes('melody', new serenade.NoteSeq(notes), serenade.Synth, attackMelody, releaseMelody);
midi.seq_notes('bass', new serenade.NoteSeq(bassNotes), serenade.Bass, attackBass, releaseBass);

midi.play(window.updateState);
		</textarea>
	      </div>
	    </div>
	  </form>
	</div>

      </div>

      <div class="row" data-bind="visible:(section()==='midi' && tune()==='still-alive')">
	<div class="span12">
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="midi-still-alive" style="width:640px; height:300px">		  
var bpm = 100;
var tempoUnit = 1/4;
var midi = new serenade.Midi(bpm,tempoUnit);

// Still Alive from Portal OST by Jonathan Coulton
midi.seq_notes('melody', new serenade.NoteSeq(notes), serenade.Synth, attackMelody, releaseMelody);
midi.seq_notes('bass', new serenade.NoteSeq(bassNotes), serenade.Bass, attackBass, releaseBass);

midi.play(window.updateState);
		</textarea>
	      </div>
	    </div>
	  </form>
	</div>

      </div>

      <div class="row" data-bind="visible:(section()==='notes-melody' && tune()==='zelda')">
	<div class="span12">
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="melody-notes-zelda" style="width: 640px; height:500px">
       var notes = "";

       // bar 1
       notes += "Bb2 R16 Bb16 Bb.16 Bb.16 Bb16 |";
       // bar 2
       notes += "Bb.8 Ab16 Bb.4 Bb16 Bb.16 Bb.16 Bb16 |";
       // bar 3
       notes += "Bb.8 Ab16 Bb.4 R16 Bb16 Bb.16 Bb.16 Bb16 |";
       // bar 4
       notes += "Bb8 F16 F16 F8 F16 F16 F8 F16 F16 F8 F8 |";
       // bar 5
       notes += "Bb4 F.4 Bb16 Bb16 C''16 D''16 Eb''16 |";
       // bar 6
       notes += "F''2 R8 F''8 F.''16 Gb.''16 Ab''16 |";
       // bar 7
       notes += "Bb.''2 Bb.''16 Bb''16 Bb.''16 Ab.''16 Gb''16 |";
       // bar 8
       notes += "Ab.''8 Gb''16 F''2 F''4 |";
       // bar 9
       notes += "Eb''8 Eb''16 F''16 Gb''2 F''8 Eb''8 |";
       // bar 10
       notes += "Db''8 Db''16 Eb''16 F''2 Eb''8 Db''8 |";
       // bar 11
       notes += "C''8 C''16 D''16 E''2 G''4 |";
       // bar 12
       notes += "F''8 F16 F16 F8 F16 F16 F8 F16 F16 F8 F8 |";
       // bar 13
       notes += "Bb4 F.4 R16 Bb16 Bb16 C''16 D''16 Eb''16 |";
       // bar 14
       notes += "F''2  R8 F''8 F.''16 Gb.''16 Ab''16 |";
       // bar 15
       notes += "Bb''2 Db'''4 |";
       // bar 16
       notes += "C'''4 A''2 F''4 |";
       // bar 17
       notes += "Gb''2 R4 B''4 |";
       // bar 18
       notes += "A''4 F''2 F''4 |";
       // bar 19
       notes += "Gb''2 R4 B''4 |";
       // bar 20
       notes += "A''4 F''2 D''4 |";
       // bar 21
       notes += "Eb''2 R4 Gb''4 |";
       // bar 22
       notes += "F''4 Db''2 Bb4 |";
       // bar 23
       notes += "C''8 C''16 D''16 E''2 G''4 |";
       // bar 24
       notes += "F''8 F16 F16 F8 F16 F16 F8 F16 F16 F8 F8";
		</textarea>
	      </div>
	    </div>
	  </form>
	</div>
    </div>

    <div class="row" data-bind="visible:(section()==='notes-bass' && tune()==='zelda')">
       <div class="span12" >
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="bass-notes-zelda" style="width: 640px; height:500px">
       var bassNotes = "";

       // bar 1
       bassNotes += "Bb,4 Bb.,16 Bb.,16 Bb,16 Bb,4 Bb,16 Bb,16 Bb,16 |";
       // bar 2
       bassNotes += "Ab,4 Ab.,16 Ab.,16 Ab,16 Ab,4 Ab.,16 Ab.,16 Ab,16 |";
       // bar 3
       bassNotes += "Gb,4 Gb.,16 Gb.,16 Gb,16 Gb,4 Gb.,16 Gb.,16 Gb,16 |";
       // bar 4
       bassNotes += "Gb,4 F,4 F,4 G,8 A,8 |";
       // bar 5
       bassNotes += "Bb,4 Bb.,16 Bb.,16 Ab,16 Bb4 Bb4 |";
       // bar 6
       bassNotes += "Ab,4 Ab.,16 Ab.,16 Gb,16 Ab,4 Ab,4 |";
       // bar 7
       bassNotes += "Gb,4 Gb.,16 Gb.,16 E,16 Gb,4 Gb,4 |";
       // bar 8
       bassNotes += "Db4 Db.16 Db.16 B,16 Db4 Db4 |";
       // bar 9
       bassNotes += "B,4 B.,16 B.,16 Bb,16 B,4 B.,16 B.,16 B,16 |";
       // bar 10
       bassNotes += "Bb,4 Bb.,16 Bb.,16 Ab,16 Bb,4 Bb.,16 Bb.,16 Bb,16 |";
       // bar 11
       bassNotes += "C4 C.16 C.16 Bb,16 C4 C.16 C.16 C16 |";
       // bar 13
       bassNotes += "F,4 F,4 F,4 G,8 A,8 |";
       // bar 14
       bassNotes += "Bb,4 Bb.,16 Bb.,16 Ab,16 Bb,4 Bb,4 |";
       // bar 15
       bassNotes += "Ab,4 Ab.,16 Ab.,16 Gb,16 Ab,4 Ab,4 |";
       // bar 16
       bassNotes += "Gb,4 Gb.,16 Gb.,16 E,16 Gb,4 Gb,4 |";
       // bar 17
       bassNotes += "F,4 F.,16 F.,16 Eb,16 F,4 F,4 |";
       // bar 18
       bassNotes += "E.,16 Bb.,16 Db'16 Eb.'16 B.'16 D''16 E''4 R4 |";
       // bar 19
       bassNotes += "F''4 F.,16 F.,16 F,16 F,4 R4 |";
       // bar 20
       bassNotes += "E.,16 Bb.,16 D'16 Eb.'16 B.'16  D''16 E''4 R4 |";
       // bar 21
       bassNotes += "F''4 F.,16 F.,16 F,16 F,4 R4 |";
       // bar 22
       bassNotes += "B,4 B.,16 B.,16 Bb,16 B,4 B.,16 B.,16 B,16 |";
       // bar 23
       bassNotes += "Bb,4 Bb.,16 Bb.,16 Ab,16 Bb,4 Bb.,16 Bb.,16 Bb,16 |";
       // bar 24
       bassNotes += "C4 C.16 C.16 Bb,16 C4 C.16 C.16 C16";
		</textarea>
	      </div>
	    </div>
	  </form>
       </div>
    </div>


      <div class="row" data-bind="visible:(section()==='notes-melody' && tune()==='still-alive')">
	<div class="span12">
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="melody-notes-still-alive" style="width: 640px; height:500px">
       var notes = "";

       // this was a tri
       notes += "G''8 F#''8 E''8 E''8 |";
       // umph
       notes += "F#''8 R8 R4 R2 |";
       // I'm making a note
       notes += "R4 R8 A8 G''8 F#''8 E''8  E''8 |";
       // here HUGE SUCCESS
       notes += "R8 F#''8 R4 D''4 E''8 A4 |";
       // It's
       notes += "R8 R4 R4 R8 A4 |";
       // hard to over-state
       notes += "E''4 F#''8 G.''4 E''8 C#''8 |";
       // my satisfac
       notes += "R8 D.''4 E''4 A4 |";
       // tion
       notes += "R8 F#''4 R8 R2 |";
       // Aperture Sci
       notes += "R2 G''8 F#''8 E''8 E''8 |";
       // ence
       notes += "F#''8 R8 R4 R2 |";
       // we do what we must
       notes += "R8 R8 A8 G''8 F#''8 E''8 E''8 |";
       // because we can.
       notes += "R4 F#''8 D''8 R4 E''8 A4 |";
       // 
       notes += "R4 R8 R4 R2 |";
       // for the good of all
       notes += "E''4 F#''8 G.''4 E''8 C#.''4 |";
       // of us except the
       notes += "D''8 E''8 R8 A8 D''8 E''8 |";
       // ones who are dead. But there's
       notes += "F''8 E''8 D''8 C''8 R4 A8 Bb8 |";
       // no sense crying over 
       notes += "C''4 F''4 E''8 D''8 D''8 C''8 |";
       // every mistake, you just
       notes += "D''8 C''8 C''4 C''4 A8 Bb8 |";
       // keep on trying till you
       notes += "C''4 F''4 G''8 F''8 E''8 D''8 |";
       // run out of cake, and the
       notes += "D''8 E''8 F''8 F''4 G''8 A''8 |";
       // Science gets done and you
       notes += "B''8 B''8 A''4 G''4 F''8 F''8 |";
       // make a neat gun for the
       notes += "A''8 A''8 G''4 F''4 D''8 C''8 |";
       // people who are still alive
       notes += "D''8 F''8 F''8 E''4 E''8 F#''8 F#''8 |";
       //
       notes += "F#''4 R4 R2";
		</textarea>
	      </div>
	    </div>
	  </form>
	</div>
    </div>

    <div class="row" data-bind="visible:(section()==='notes-bass' && tune()=='still-alive')">
       <div class="span12" >
	  <form class="form-horizontal">
	    <div class="control-group">
	      <div class="controls">
		<textarea class="input-xlarge" id="bass-notes-still-alive" style="width: 640px; height:500px">
       var bassNotes = "";

       // this was a tri
       bassNotes += "R2 |";
       // umph
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // I'm making a note
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // here HUGE SUCCESS
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // It's
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // hard to over-state
       bassNotes += "B8 E''8 G''8 E''8 B8 E''8 G''8 E''8 |";
       // my satisfac
       bassNotes += "A8 C#''8 G''8 C#''8 A8 C#''8 G''8 C#''8 |";
       // tion
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // Aperture Sci
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // ence
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // we do what we must
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // because we can.
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       //
       bassNotes += "A8 D''8 F#''8 D''8 B8 D''8 F#''8 D''8 |";
       // for the good of all
       bassNotes += "B8 E''8 G''8 E''8 B8 E''8 G''8 E''8 |";
	// of us except the
       bassNotes += "A8 C#''8 G''8 C#''8 A8 C#''8 G''8 C#''8 |";
       // ones who are dead. But there's
       bassNotes += "Bb8 D''8 F''8 A''8 A''2 |";
       // no sense crying over
       bassNotes += "C#'':F#''8 A''8 C#'':F#''4 C#'':E''8 G''8 C#'':E''4 |";
       // every mistake, you just
       bassNotes += "Bb:D''8 B''8 Bb:D''8 E''8 C#'':F#''8 A''8 C#'':F''4 |";
       // keep on trying till you
       bassNotes += "C'':F''8 A''8 C'':F''4 C'':E''8 G''8 C'':E''4 |";
       // run out of cake, and the
       bassNotes += "Bb:D''8 B''8 Bb:D''8 E''8 C'':F''8 A''8 C'':F''4 |";
       // Science gets done and you
       bassNotes += "Bb:D''8 G''8 Bb:D''8 G''8 C'':E''8 G''8 C'':E''8 G''8 |";
       // make a neat gun for the
       bassNotes += "C'':F''8 A''8 C'':F''8 A''8 D'':F''8 A''8 D'':F''8 D'':F'':A''8 |";
       // people who are still alive
       bassNotes += "Bb16 D''16 G''8 Bb:D''8 Bb:D'':G''8 A:C#''8 G''8 A:C''8 G''8 |";
       //
       bassNotes += "D D.:A.:D.'':F.''4 D'':G''8 D'':F''8 A:D''8" 
		</textarea>
	      </div>
	    </div>
	  </form>
       </div>
    </div>

    <div class="row" data-bind="visible:section()==='instrument-melody'">
      <div class="span12" >
	<form class="form-horizontal">
	  <div class="control-group">
	    <div class="controls">
	      <textarea class="input-xlarge" id="melody-instrument" style="width: 640px; height:200px">
      var attackMelody = 0.4;
      var releaseMelody = 0.2;
	      </textarea>
	    </div>
	  </div>
	</form>
      </div>
    </div>


    <div class="row" data-bind="visible:section()==='instrument-bass'">
      <div class="span12" >
	<form class="form-horizontal">
	  <div class="control-group">
	    <div class="controls">
	      <textarea class="input-xlarge" id="bass-instrument" style="width: 640px; height:200px">
      var attackBass = 0.2;
      var releaseBass = 0.1;
	      </textarea>
	    </div>
	  </div>
	</form>
      </div>
    </div>
</span>

    <!-- end of container -->
    </div>

  </body>
</html>
